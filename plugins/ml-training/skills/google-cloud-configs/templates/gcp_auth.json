{
  "_comment": "GCP Authentication Configuration Template",
  "_warning": "NEVER commit real credentials to version control!",
  "_usage": "Replace placeholder values with actual credentials",

  "type": "service_account",
  "project_id": "your_project_id_here",
  "private_key_id": "your_private_key_id_here",
  "private_key": "-----BEGIN PRIVATE KEY-----\nyour_private_key_here\n-----END PRIVATE KEY-----\n",
  "client_email": "your-service-account@your-project.iam.gserviceaccount.com",
  "client_id": "your_client_id_here",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/your-service-account%40your-project.iam.gserviceaccount.com",

  "_instructions": {
    "how_to_create": [
      "1. Go to Google Cloud Console: https://console.cloud.google.com",
      "2. Navigate to IAM & Admin > Service Accounts",
      "3. Click 'Create Service Account'",
      "4. Enter name and description",
      "5. Grant roles (see required_roles below)",
      "6. Click 'Create Key' and select JSON format",
      "7. Download and save securely - NEVER commit to git!"
    ],

    "required_roles": [
      "roles/bigquery.dataEditor - For BigQuery ML training",
      "roles/bigquery.jobUser - For running BigQuery jobs",
      "roles/aiplatform.user - For Vertex AI training",
      "roles/storage.objectAdmin - For Cloud Storage access",
      "roles/serviceusage.serviceUsageConsumer - For API usage"
    ],

    "security_best_practices": [
      "✅ Store key files outside of git repositories",
      "✅ Add *.json to .gitignore",
      "✅ Use Secret Manager for production",
      "✅ Rotate keys every 90 days",
      "✅ Grant minimum necessary permissions",
      "✅ Use Workload Identity for GKE",
      "✅ Enable Cloud Audit Logs",
      "✅ Monitor key usage",
      "❌ Never hardcode credentials in code",
      "❌ Never commit key files to git",
      "❌ Never share keys via email/chat",
      "❌ Never use personal accounts for production"
    ],

    "usage_in_python": {
      "method_1_env_variable": [
        "import os",
        "os.environ['GOOGLE_APPLICATION_CREDENTIALS'] = '/path/to/this/file.json'",
        "from google.cloud import bigquery",
        "client = bigquery.Client()"
      ],

      "method_2_explicit": [
        "from google.cloud import bigquery",
        "from google.oauth2 import service_account",
        "",
        "credentials = service_account.Credentials.from_service_account_file(",
        "    '/path/to/this/file.json'",
        ")",
        "client = bigquery.Client(credentials=credentials, project='your_project_id')"
      ],

      "method_3_secret_manager": [
        "from google.cloud import secretmanager",
        "from google.oauth2 import service_account",
        "import json",
        "",
        "client = secretmanager.SecretManagerServiceClient()",
        "name = 'projects/PROJECT_ID/secrets/ml-training-key/versions/latest'",
        "response = client.access_secret_version(request={'name': name})",
        "key_data = json.loads(response.payload.data.decode('UTF-8'))",
        "credentials = service_account.Credentials.from_service_account_info(key_data)"
      ]
    },

    "usage_in_bash": {
      "set_env_variable": [
        "export GOOGLE_APPLICATION_CREDENTIALS='/path/to/this/file.json'",
        "gcloud auth activate-service-account --key-file=$GOOGLE_APPLICATION_CREDENTIALS"
      ],

      "verify_auth": [
        "gcloud auth list",
        "gcloud config get-value account",
        "gcloud projects get-iam-policy $PROJECT_ID"
      ]
    },

    "alternative_auth_methods": {
      "user_account": {
        "description": "Use your personal Google account (for local development)",
        "setup": [
          "gcloud auth login",
          "gcloud auth application-default login"
        ],
        "pros": ["Easy setup", "No key management", "Good for development"],
        "cons": ["Not suitable for production", "Limited automation", "Requires browser access"]
      },

      "workload_identity": {
        "description": "Link Kubernetes service account to GCP service account (for GKE)",
        "setup": [
          "1. Enable Workload Identity on GKE cluster",
          "2. Create GCP service account",
          "3. Create Kubernetes service account",
          "4. Bind them together:",
          "   gcloud iam service-accounts add-iam-policy-binding \\",
          "     SERVICE_ACCOUNT@PROJECT.iam.gserviceaccount.com \\",
          "     --role=roles/iam.workloadIdentityUser \\",
          "     --member='serviceAccount:PROJECT.svc.id.goog[NAMESPACE/KSA_NAME]'",
          "5. Annotate Kubernetes service account:",
          "   kubectl annotate serviceaccount KSA_NAME \\",
          "     iam.gke.io/gcp-service-account=SERVICE_ACCOUNT@PROJECT.iam.gserviceaccount.com"
        ],
        "pros": ["No key files", "Most secure", "Automatic rotation"],
        "cons": ["GKE only", "More complex setup"]
      },

      "application_default_credentials": {
        "description": "Auto-detect credentials from environment",
        "order": [
          "1. GOOGLE_APPLICATION_CREDENTIALS environment variable",
          "2. User credentials from gcloud auth application-default login",
          "3. GCE/GKE metadata server",
          "4. Error if none found"
        ],
        "usage": ["Simply omit credentials parameter in client initialization"]
      }
    },

    "troubleshooting": {
      "permission_denied": [
        "Check IAM roles are granted to service account",
        "Verify project ID is correct",
        "Ensure APIs are enabled (BigQuery, Vertex AI, etc.)",
        "Check if key is expired or revoked"
      ],

      "key_not_found": [
        "Verify GOOGLE_APPLICATION_CREDENTIALS path is correct",
        "Check file permissions are readable",
        "Ensure JSON format is valid",
        "Try absolute path instead of relative"
      ],

      "quota_exceeded": [
        "Check quotas in Cloud Console",
        "Request quota increase if needed",
        "Verify billing is enabled",
        "Check for resource limits (GPU/TPU availability)"
      ]
    },

    "gitignore_entries": [
      "# GCP credentials",
      "gcp-*.json",
      "*-key.json",
      "service-account*.json",
      ".gcp_auth_config",
      "*.pem",
      "credentials.json",
      "",
      "# Except examples/templates",
      "!**/templates/*.json",
      "!**/examples/*-example.json"
    ]
  },

  "_metadata": {
    "template_version": "1.0.0",
    "last_updated": "2025-01-04",
    "documentation": "https://cloud.google.com/iam/docs/service-accounts",
    "key_management_guide": "https://cloud.google.com/iam/docs/best-practices-for-managing-service-account-keys"
  }
}
